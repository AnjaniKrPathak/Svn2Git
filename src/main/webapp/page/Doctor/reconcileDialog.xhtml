<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:p="http://primefaces.org/ui" template="../templates/ui.xhtml">	

<ui:composition>
<p:dialog id="reconcilePopUpId13" header="#{msg.reconcile}"
	 			widgetVar="reconcilePopUp" closable="false"  modal="true" 
				appendTo="@(body)" height="488" width="610" resizable="true" position="370,80" dynamic="true">
		<p:ajax event="close" update="reconcilePopUpId13"></p:ajax>
		<br/>
	 <p:outputPanel id="get_med_history1" autoUpdate="true" deferred="true" deferredMode="visible">
	 
	 
	 <p:outputPanel >
	    		
	    		<h:form id="claimHistort1formIDFor1">
	    		<table>
			<tr>
				<td>
					<h:outputText value="Time Frame:" />
				</td>
				<td>
					<p:selectOneMenu 
								value="#{patientMedicineManageBean.timeFrameForReconcile}"
								style="width:122px;">
								<!-- <f:selectItem itemLabel="4 Month" itemValue="4" /> -->
								<!-- <f:selectItem itemLabel="6 Months" itemValue="6" /> -->
								<f:selectItem itemLabel="1 Year" itemValue="12" />
								<f:selectItem itemLabel="2 Years" itemValue="24" />
								<f:selectItem itemLabel="All" itemValue="48" />
								<p:ajax listener="#{patientMedicineManageBean.changeTimeFrameForPharmacyHistory}"
									  process="@this" />
							</p:selectOneMenu> 
				</td>
				
				<td></td>
				<td >
	    		
	    			<!-- <p:commandButton value="Update Pharmacy History" actionListener="#{patientMedicineManageBean.updatePharmacyHistory}"></p:commandButton> -->
	    			<p:commandLink actionListener="#{patientMedicineManageBean.updatePharmacyHistory}"  update="@form">
				   <h:graphicImage value="./../../Images/download3.png"
                                                height="28px" width="26px" id="pharmacy_history"/>
                                                 <p:tooltip for="pharmacy_history"  showEffect="clip"  hideEffect="explode">
				 
				<h:outputText value="#{msg.update_pharmacy_history}"/>
				
				</p:tooltip>
				</p:commandLink>
				
	    			</td>
				
	    		</tr>
			</table></h:form></p:outputPanel>
	 
	 <table width="100%">
		<tr>
		
		
		<td>
		<!-- <p:commandButton value="#{msg.getPharmacyHistory}" actionListener="#{patientMedicineManageBean.goToPharmacyHistory}" update=":get_med_history1"></p:commandButton>
		
		
		&nbsp;&nbsp;
		 <p:commandButton value="#{msg.getMedicineHistory}" actionListener="#{patientMedicineManageBean.goToMedHistory}" update=":get_med_history1"></p:commandButton>
		 -->	 
			 <!-- <p:commandButton value="#{msg.showpharmacyhistory}"></p:commandButton> -->
			 </td>
			 <td align="right" >
			 <p:commandButton value="#{msg.done}" 
			 				   onclick="reconcilePopUp.hide();" update="PMRFormIdFilter:medPanelId" 
			 				   action="#{patientMedicineManageBean.saveReconcileMed}"></p:commandButton>
			<p:commandButton value="Close" onclick="reconcilePopUp.hide();"/> 
			</td>
			<p:messages  id="messageUpdateFOrReconcile" showDetail="false" style="color:#FF0000;margin:8px;"  closable="true" /> 
			</tr>
			</table>
			
	       <table>
	      	 <tr>
	  			 <td valign="top">
	  			 	<p:dataTable id="currentMed1"
	     						value="#{patientMedicineManageBean.patientMedicationDataList}"
	    						 rowIndexVar="columnId" var="currentMedDetail" emptyMessage="#{msg.noMedFound}">
					      <p:column>
					      	<p:commandButton icon="ui-icon-arrow-1-e"  rendered="#{currentMedDetail.checkReconcileMedToCurrent}"
					      		 actionListener="#{patientMedicineManageBean.cancelCurrentMedicineforoverview}"
					       		update="currentMed1" >
					       		<f:param id="medicineName1" name="medicineName" value="#{currentMedDetail.drugs}"></f:param>
					       		<f:param id="drugId" name="drugId" value="#{currentMedDetail.drugId}"></f:param>
					     	 </p:commandButton>
					     </p:column>
	
					     <p:column sortBy="drugs">
						      <f:facet name="header">
						       	<h:outputText value="#{msg.currentmeds}" />
						      </f:facet>
						      <h:outputText value="#{currentMedDetail.drugs}" /><br/>
						      <h:outputText value="#{currentMedDetail.startDate}">
						       	<f:convertDateTime pattern="#{msg.dateFormat}" />
						      </h:outputText>
						      <h:outputText
						       		value=" #{currentMedDetail.strengths} #{currentMedDetail.directions} #{currentMedDetail.prescriberName}" />
					     </p:column>
	    			</p:dataTable>
	    		</td>
	   			<td valign="top">
	    		
	    		<!-- ################## show pharmacy History............ -->
	    		<p:outputPanel id="get_pharmacy_history" rendered="#{!patientMedicineManageBean.showMedHistoryForReconcile}">
	    		
	    		<h:form id="claimHistort1formIDFor">
			<p:outputPanel id="updatePharHistory" deferred="true" deferredMode="visible">
					     <p:dataTable id="claimHistort11"  binding="#{patientMedicineManageBean.reconsileMedsForPharmacyDataTableforoverviewfilter}"
					      		value="#{patientMedicineManageBean.pharmacyMedsMedsListForReconcile}"
					      		var="MedDetailHistory" emptyMessage="#{msg.noMedFound}">
						      <p:column>
							        <p:commandButton icon="ui-icon-arrow-1-w"
							        	action="#{patientMedicineManageBean.duplicatechangePharmacyHistoryTOCurrentMedicinforoverviewfilter}"
							        	update=":currentMed1,:messageUpdateFOrReconcile,:PMRFormIdFilter:reconcileDateId,:PMRFormIdFilter:lastReconcileINfo" process="@form">
							       </p:commandButton>
						      </p:column>
					
						      <p:column sortBy="drugs">
						       	<f:facet name="header">
						        		<h:outputText value="#{msg.getPharmacyHistory}" />
						       	</f:facet>
						       	<h:outputText value="#{MedDetailHistory.drugs}," />
						       <!-- 	  	<h:outputText value="#{MedDetailHistory.drugId}," /> -->
						       	<h:outputText value="#{MedDetailHistory.strengths}," rendered="#{MedDetailHistory.strengths ne null}"/>
						       	<h:outputText value="#{MedDetailHistory.directions}," rendered="#{MedDetailHistory.directions ne null}"/>
						       <h:outputText value="#{MedDetailHistory.quantity}," />
						       	<h:outputText value="#{MedDetailHistory.prescriberName}," /><br />
						       	<h:outputText value="#{MedDetailHistory.startDate}" >
						       		<f:convertDateTime pattern="#{msg.dateFormat}" />
						       	</h:outputText>
						      </p:column>
					     </p:dataTable>
					     </p:outputPanel>
	    			</h:form>
	    		</p:outputPanel>
	    		
	    		</td>
	 		 </tr>
	 	</table>
	 </p:outputPanel> 
	</p:dialog>
	</ui:composition>
	</html>