<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="../templates/ui.xhtml">

<h:body >


	<f:view contentType="text/html">
		<h:head>
			<f:facet name="first">
				<meta http-equiv="X-UA-Compatible" content="EmulateIE8" />
				<meta content='text/html; charset=UTF-8' http-equiv="Content-Type" />
				<title><h:outputText value="#{msg.clinakos}" /></title>
				
			</f:facet>
			<link type="text/css" rel="stylesheet" href="../../CSS/style.css" />
			<script language="javascript" src="../js/basicMethod.js"></script>
			<style type="text/css">
    .animated .ui-progressbar-value { 
        background-image: url("../../Images/progress_bar.gif"); 
    }
</style>
		</h:head>

		<p:layout fullPage="true">

			<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> DOCTOR HEADER >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  -->
			<p:layoutUnit position="north" size="93" minSize="60">
				<ui:include src="batchPullHeader.xhtml" />
			</p:layoutUnit>

			<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BOTTOM INCLUDE >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  -->

			<p:layoutUnit id="bottom" position="south" size="24">
				<h:form>
					<ui:include src="../core/footer.xhtml"></ui:include>
				</h:form>
			</p:layoutUnit>

			<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> LEFT INCLUDE >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  -->

			  <p:layoutUnit id="left" position="west" size="0" closable="false" collapsible="true" minSize="0" style="border:none;">
				  <ui:include src="toolleftmenu.xhtml">
				</ui:include>
			</p:layoutUnit>
			

			<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> CENTER LAYOUT >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  -->

			<p:layoutUnit position="center" resizable="true" >
				<h:form id="batchPull">
				 <!-- <h:outputText value="Time Elapsed(in Sec)"></h:outputText> -->
				 <h:inputHidden id="txt_batchDataPullTimeDuration" value="#{userManageBean.batchDataPullTimeDuration}"></h:inputHidden>
				  <p:poll  interval="3300" listener="#{userManageBean.refreshApplicationForBatchDataPull}" update="txt_batchDataPullTimeDuration" ></p:poll>
				 <p:growl id="messages" showDetail="true" />
				 <p:panel >
				<table width="100%" >
				<tr style="padding-bottom: 30;border-spacing: 10" valign="top">
				 <td >
					 <h:outputText value="#{msg.time_period}" style="vertical-align:top"/>
					<!-- </td>
					 <td > -->
				  <p:spacer width="5px;"></p:spacer>
				  <p:selectOneMenu value="#{userManageBean.timePeriod}" style="width:100px;margin:-5px 0px 0px 0px;">
					 <f:selectItem itemLabel="---Select---" itemValue=""/>
					 <f:selectItem itemLabel="4 Months" itemValue="4"/>
					 <f:selectItem itemLabel="8 Months" itemValue="8"/>
					 <f:selectItem itemLabel="1 Year" itemValue="12"/>
					 <f:selectItem itemLabel="2 Year" itemValue="24"/>
					 <f:selectItem itemLabel="3 Year" itemValue="36"/>
					 <f:selectItem itemLabel="4 Year" itemValue="48"/>
				  </p:selectOneMenu>
			   </td>
			   <td >
 			    <h:outputText value="#{msg.patient_batch_date}" style="vertical-align:top;"/>
				  <!-- </td>
				  <td> -->
				<p:spacer width="5px;"/>
				<p:selectOneMenu id="patBatchDate" value="#{userManageBean.patientBatchDate}" style="width:100px;margin:-5px 0px 0px 0px;">
				  <f:selectItem itemLabel="---Select---"/>
				  <f:selectItems value="#{userManageBean.patientBatchDateList}"></f:selectItems>
				 <!--  <p:ajax  listener="#{userManageBean.resetBatchFilter}" ></p:ajax>  -->
				</p:selectOneMenu>
			  </td>
			  <td >
			   <h:outputText value="#{msg.patient_batch_no}" style="vertical-align:top"/>
			  <!-- </td>
			  <td> -->
			  <p:spacer width="5px;"/>
			   <p:selectOneMenu id="patBatchNo" value="#{userManageBean.userLoginDetail.patientBatchNo}" style="width:100px;margin:-5px 0px 0px 0px;"  >
				    <f:selectItem itemLabel="---Select---"/>
				    <f:selectItems value="#{userManageBean.patientBatchNumberDataList}"></f:selectItems>
				  <!--   <p:ajax listener="#{userManageBean.resetBatchFilter}" ></p:ajax> -->
			   </p:selectOneMenu>
			  </td>
			  <td>
				 <p:commandButton id="filterPatDataBtn" value="Filter Patient Data" 
				 	actionListener="#{userManageBean.getPatientConsentDataWithFilter}" update="batchPullProcessPatientDataTab" style="margin:-5px 0px 0px 0px;" />
			  </td>
			 <td > 
			   <p:commandButton id="dataPullProcessBtn" async="true" value="Selected BatchData Pull" 
			   				action="#{userManageBean.multiThreadingBatchDataPullingForPatientConsentGrantPatient}" 
			   			update=":dataPullStausDlg,batchPullProcessPatientDataTab" style="margin:-5px 0px 0px 0px;"  onclick="pbAjax.start()"   />
			 </td>
			 <td > 
			   <p:commandButton id="allDataPullProcessBtn" async="true" value="All BatchData Pull" 
			   				action="#{userManageBean.batchDataPullingForAllPatient}" 
			   			update=":dataPullStausDlg,batchPullProcessPatientDataTab" style="margin:-5px 0px 0px 0px;"  onclick="pbAjax.start()"   />
			 </td>
			 <td>
			<!--  <p:commandButton id="deIdentificationDataProcessBtn" value="Run De-Identification Process" actionListener="#{userManageBean.deIdentificationDataProcess}" style="margin:-5px 0px 0px 0px;"/> -->

				 <p:commandButton id="deIdentificationDataProcessBtn" value="Run De-Identification" 
				 		actionListener="#{userManageBean.deIdentificationDataProcess}" style="margin:-5px 0px 0px 0px;"/>

			 </td>
			</tr>
			<tr/>
			<tr/>
			<tr>
				<td colspan="8">
				<p:outputPanel id="progressBarPanel" >
				 <p:progressBar  widgetVar="pbAjax"   ajax="true" value="#{userManageBean.completedPerc}" interval="100"  labelTemplate="{value}% Process Completed" rendered="#{!(userManageBean.completedPerc eq 100)}" global="false" >
                   
                  </p:progressBar> 
                 
                 </p:outputPanel>
                 
				</td>
				</tr>
				
			<tr style="height:30px"/>
				 <tr>
				  <td colspan="8">
				  <p:outputPanel id="batchDataPull" >
				   <p:dataTable  value="#{userManageBean.patientDataWithPatientConsentForBatchDataPullProcessList}" var="patDataBatPull" rowStyleClass="outline-color: #00ff00;	outline-style: dotted;"  paginator="true"
				   selection="#{userManageBean.selectedUserLoginDetail}" rowKey="#{patDataBatPull.userId}" id="batchPullProcessPatientDataTab"   scrollHeight="400"  paginatorPosition="bottom"  rowsPerPageTemplate="25,50,100,200" rows="50">
				   <p:ajax event="rowSelectCheckbox" update="batchPullProcessPatientDataTab" process="@this"   />
				   <p:ajax event="rowUnselectCheckbox" update="batchPullProcessPatientDataTab" process="@this"   />
				   <p:ajax event="rowSelect" update="batchPullProcessPatientDataTab" process="@this"   />
				   <p:ajax event="rowUnselect" update="batchPullProcessPatientDataTab" process="@this"   />
				   <p:column selectionMode="multiple" style="width:3%; text-align:center;align:center;"  >
				  <!--  <h:outputText value="This Patient can not be batched "  ></h:outputText> -->
				   </p:column> 
				  
				      <p:column>
				    
				     <p:outputPanel rendered="#{patDataBatPull.pbmDrugHistoryDetailStatus eq false and patDataBatPull.pbmDrugHistoryResultStatus eq false}">
				     <h:graphicImage value="./../../Images/red1.jpg"
                                                height="22px" width="20px" id="PBMDetailData" alt="Clear All" styleClass="cmdLinkBgCol"/>
                                                 <p:tooltip for="PBMDetailData" value="This Patient has No PBM Information Detail." showEffect="clip"  hideEffect="explode"></p:tooltip>
                                                 </p:outputPanel>
                       <!-- <h:outputText value="#{patDataBatPull.pbmDrugHistoryDetailStatus}"/>
                       <h:outputText value="#{patDataBatPull.pbmDrugHistoryResultStatus}"></h:outputText>   -->                        
                                               
                     <p:outputPanel rendered="#{patDataBatPull.pbmDrugHistoryDetailStatus eq true and patDataBatPull.pbmDrugHistoryResultStatus eq false}">
				     <h:graphicImage value="./../../Images/orange1.jpg"  height="22px" width="20px" id="PBMResultData" alt="Clear All" styleClass="cmdLinkBgCol"/>
                                               
                                                 <p:tooltip for="PBMResultData" value="This patient has PBM but no  medication detail." showEffect="clip"  hideEffect="explode"></p:tooltip>
                                                 </p:outputPanel>  
                                                                           
                                                 
				  <p:outputPanel rendered="#{patDataBatPull.pbmDrugHistoryDetailStatus eq true and patDataBatPull.pbmDrugHistoryResultStatus eq true}">
				     <h:graphicImage value="./../../Images/green1.jpg"
                                                height="22px" width="20px" id="PBMDetailDataWithMedication" alt="Clear All" styleClass="cmdLinkBgCol"/>
                                                 <p:tooltip for="PBMDetailDataWithMedication" value="This patient has both PBM Eligiblity and Medication Detail Data . " showEffect="clip"  hideEffect="explode"></p:tooltip>
                                                 </p:outputPanel>
                     
                                                 
				    </p:column>  
				    
				    <p:column  headerText="#{msg.patient_batch_date}" sortBy="patientBatchCreatedDate" >
				     
				     <h:outputText value="#{patDataBatPull.patientBatchCreatedDate}"/>
				    </p:column>
				    
				    <p:column sortBy="patientBatchNo">
				    <f:facet name="header">
				     <h:outputText value="#{msg.patient_batch_no}"/>
				    </f:facet>
				    <h:outputText value="#{patDataBatPull.patientBatchNo}"/>
				    
				    </p:column>
				    
				    <p:column sortBy="userId"  >
				     <f:facet name="header">
				      <h:outputText value="#{msg.patientID}"/>
				     </f:facet>
				     <h:outputText value="#{patDataBatPull.userId}"/>
				    </p:column>
				    <p:column sortBy="firstName">
				     <f:facet name="header">
				      <h:outputText value="#{msg.patientName}"/>
				     </f:facet>
				     <h:outputText value="#{patDataBatPull.firstName} #{patDataBatPull.lastName}"/>
				    </p:column>
				    <p:column sortBy="dateOfBirth">
				    <f:facet name="header">
				    <h:outputText value="#{msg.dob}"/>
				    </f:facet>
				    <h:outputText value="#{patDataBatPull.dateOfBirth}">
				    <f:convertDateTime pattern="#{msg.dateFormat}"/>
				    </h:outputText>
				    </p:column>
				    <p:column sortBy="gender">
				    <f:facet name="header">
				     <h:outputText value="#{msg.gender}"/>
				    </f:facet>
				    <h:outputText value="#{patDataBatPull.gender}"/>
				    </p:column>
				    <p:column sortBy="state" >
				     <f:facet name="header">
				      <h:outputText value="#{msg.state}"/>
				     </f:facet>
				     <h:outputText value="#{patDataBatPull.state}"/>
				    </p:column>
				   
				   </p:dataTable>
				   </p:outputPanel>
				  </td>
				 
				 </tr>
				 <tr>
				  <td>
				  
                 
				  </td>
				 </tr>
				
				
				</table>
				</p:panel>
				
				<p:blockUI block="batchDataPull" trigger="dataPullProcessBtn">  
                              Batch Running ...<br />
								<p:graphicImage value="./../../Images/ajax_loader.gif"
									width="40" height="40" />
							</p:blockUI>
							
				<p:blockUI block="batchDataPull" trigger="allDataPullProcessBtn">  
                              Batch Running ...<br />
								<p:graphicImage value="./../../Images/ajax_loader.gif"
									width="40" height="40" />
							</p:blockUI>
				<p:blockUI block="batchDataPull" trigger="filterPatDataBtn">  
                              Filtering Patient ...<br />
								<p:graphicImage value="./../../Images/ajax_loader.gif"
									width="40" height="40" />
							</p:blockUI>
							<p:blockUI block="batchDataPull" trigger="batchPullProcessPatientDataTab">  
                               <br />
								<p:graphicImage value="./../../Images/ajax_loader.gif"
									width="40" height="40" />
							</p:blockUI>
							
							<p:blockUI block="batchDataPull" trigger="deIdentificationDataProcessBtn">  
                                De-Identification Data Processing ...<br />
								<p:graphicImage value="./../../Images/ajax_loader.gif"
									width="40" height="40" />
							</p:blockUI>				
				</h:form>
				
				
				
					</p:layoutUnit>
					
					<p:dialog id="dataPullStausDlg" widgetVar="batchDataPullResult" header="Pull Data Result Status" dynamic="true" resizable="true" appendToBody="false">
					<h:form >
					<p:panel id="dataPullStatus">
					
				<table>
				<tr>
				 <td>
				  <h:outputText value="Number of Patient PBM Eligibility  Pulled : "/>
				  
				 </td>
				 <td>
				  <h:outputText value="#{userManageBean.totalNoOfPatientPulled}"/>
				 </td>
				</tr>
				<tr>
				 <td>
				  <h:outputText value="Number of Patient  that had Medications: "/>
				  
				 </td>
				 <td>
				  <h:outputText value="#{userManageBean.patientHaveMedications}"/>
				 </td>
				
				</tr>
				<tr>
				 <td>
				  <h:outputText value="Total # of Medication Records Pulled :"/>
				 </td>
				 <td>
				  <h:outputText value="#{userManageBean.totalNoOfPatientMedicalRecordPulled}"></h:outputText>
				 </td>
				</tr>
				<tr>
				 <td>
				  <h:outputText value="Number of Patients Not Pulled :"/>
				 </td>
				 <td>
				 <h:outputText value="#{userManageBean.noOfPatientNotGetRecord}"/>
				 
				 </td>
				</tr>
				</table>
				</p:panel>
			
				</h:form>
				</p:dialog>
					</p:layout>
					</f:view>
					
				
</h:body>
</html>